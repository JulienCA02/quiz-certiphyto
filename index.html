<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz d'entra√Ænement Certiphyto</title>
<style>
  body {font-family: Arial, sans-serif;background-color: #f4f7f9;color: #333;text-align: center;margin: 0;padding: 0;}
  header {background: #005a2b;color: white;padding: 15px 10px;display: flex;align-items: center;justify-content: center;gap: 10px;}
  header img {height: 60px;}
  h1 {margin: 10px 0;}
  .category-btn {display: block;margin: 15px auto;padding: 15px 25px;width: 320px;font-size: 16px;background: #007a3d;color: white;border: none;border-radius: 10px;cursor: pointer;transition: background 0.3s, transform 0.2s;}
  .category-btn:hover {background: #00a650;transform: scale(1.03);}
  #quiz-container {display: none;margin-top: 20px;max-width: 700px;margin-left: auto;margin-right: auto;}
  .question {font-size: 20px;margin-bottom: 15px;}
  .options {text-align: left;}
  .option {background: #fff;border: 2px solid #ddd;padding: 10px;border-radius: 8px;margin: 8px 0;cursor: pointer;transition: all 0.3s;}
  .option:hover {background: #f0f0f0;}
  .option.selected {background-color: #cce5ff;border-color: #007bff;}
  .option.correct {background-color: #c8f7c5;border-color: #2ecc71;}
  .option.incorrect {background-color: #f7c5c5;border-color: #e74c3c;}
  button {margin-top: 20px;padding: 12px 20px;font-size: 16px;border: none;border-radius: 8px;cursor: pointer;}
  #validate-btn {background-color: #007a3d;color: white;}
  #validate-btn:hover {background-color: #009e4d;}
  #next-btn, .blue-btn {background-color: #007bff;color: white;}
  #next-btn:hover, .blue-btn:hover {background-color: #3399ff;}
  #stop-btn, .red-btn {background-color: #e74c3c;color: white;}
  #stop-btn:hover {background-color: #ff6b5a;}
  #home-btn {background-color: #007a3d;color: white;}
  #home-btn:hover {background-color: #009e4d;}
  #progress {font-weight: bold;margin: 10px 0;}
  #result {font-size: 22px;font-weight: bold;}
  #feedback {font-size: 18px;font-weight: bold;margin-top: 10px;}
</style>
</head>
<body>
<header><img src="logo.png" alt="Logo"><h1>Quiz d'entra√Ænement Certiphyto</h1></header>
<div id="home">
  <h2>Choisissez votre cat√©gorie :</h2>
  <button class="category-btn" data-file="questions-densa-ea.json" data-title="D√©cideur en entreprise non soumise √† agr√©ment - Exploitation agricole">DENSA<br><small>D√©cideur en entreprise non soumise √† agr√©ment - Exploitation agricole</small></button>
  <button class="category-btn" data-file="questions-densa-col.json" data-title="D√©cideur en entreprise non soumise √† agr√©ment - Collectivit√©">DENSA<br><small>D√©cideur en entreprise non soumise √† agr√©ment - Collectivit√©</small></button>
  <button class="category-btn" data-file="questions-desa.json" data-title="D√©cideur en entreprise soumise √† agr√©ment - Prestation de services du secteur agricole et forestier">DESA<br><small>D√©cideur en entreprise soumise √† agr√©ment - Prestation de services du secteur agricole et forestier</small></button>
  <button class="category-btn" data-file="questions-operateur-ea.json" data-title="Op√©rateur - Exploitation agricole">OP√âRATEUR<br><small>Exploitation agricole</small></button>
  <button class="category-btn" data-file="questions-operateur-col.json" data-title="Op√©rateur - Collectivit√©">OP√âRATEUR<br><small>Collectivit√©</small></button>
</div>
<div id="quiz-container">
  <h2 id="category-title"></h2>
  <div id="progress"></div>
  <div id="question-container"></div>
  <div id="feedback"></div>
  <button id="validate-btn">Valider</button>
  <button id="next-btn" style="display:none;">Question suivante</button>
  <button id="stop-btn">Arr√™ter le quiz</button>
  <div id="result"></div>
</div>
<script>
let questions=[],currentIndex=0,score=0,category="",totalQuestions=30,minScore=15,currentFile="";
document.querySelectorAll(".category-btn").forEach(btn=>{btn.addEventListener("click",()=>{const file=btn.dataset.file;currentFile=file;category=btn.dataset.title;document.getElementById("category-title").textContent=category;document.getElementById("home").style.display="none";document.getElementById("quiz-container").style.display="block";loadQuestions(file);});});
async function loadQuestions(file){
  try{
    document.getElementById("result").innerHTML="";
    document.getElementById("feedback").textContent="";
    document.getElementById("validate-btn").style.display="inline-block";
    document.getElementById("next-btn").style.display="none";
    document.getElementById("stop-btn").style.display="inline-block";
    const response=await fetch(file+"?v="+Date.now());
    questions=await response.json();
    if(file.includes("operateur")){totalQuestions=20;minScore=12;}
    else if(file.includes("desa")){totalQuestions=30;minScore=20;}
    else{totalQuestions=30;minScore=15;}
    questions=questions.sort(()=>0.5-Math.random()).slice(0,totalQuestions);
    currentIndex=0;score=0;showQuestion();
  }catch(e){alert("Erreur de chargement des questions : "+e);}
}
function showQuestion(){
  const q=questions[currentIndex];
  document.getElementById("progress").textContent=`Question ${currentIndex+1} / ${totalQuestions}`;
  const c=document.getElementById("question-container");
  c.innerHTML=`<div class='question'>${q.q}</div>`;
  const opts=document.createElement("div");opts.classList.add("options");
  q.options.forEach((opt,i)=>{const d=document.createElement("div");d.classList.add("option");d.textContent=opt;d.addEventListener("click",()=>d.classList.toggle("selected"));opts.appendChild(d);});
  c.appendChild(opts);
  document.getElementById("feedback").textContent="";
  document.getElementById("validate-btn").style.display="inline-block";
  document.getElementById("next-btn").style.display="none";
}
document.getElementById("validate-btn").addEventListener("click",()=>{
  const allOpt=Array.from(document.querySelectorAll(".option"));
  const sel=allOpt.map((o,i)=>o.classList.contains("selected")?i:-1).filter(i=>i!==-1);
  if(sel.length===0)return alert("Veuillez s√©lectionner au moins une r√©ponse.");
  const q=questions[currentIndex];const corr=Array.isArray(q.answers)?q.answers.slice():[];
  const eq=(a,b)=>a.length===b.length&&a.every((v,i)=>v===b[i]);
  const good=eq(sel.slice().sort((x,y)=>x-y),corr.slice().sort((x,y)=>x-y));
  allOpt.forEach((o,i)=>{o.style.pointerEvents='none';if(corr.includes(i))o.classList.add("correct");if(o.classList.contains("selected")&&!corr.includes(i))o.classList.add("incorrect");});
  if(good){score++;document.getElementById("feedback").textContent="‚úÖ Bonne r√©ponse !";document.getElementById("feedback").style.color="#2ecc71";}
  else{document.getElementById("feedback").textContent="‚ùå Mauvaise r√©ponse.";document.getElementById("feedback").style.color="#e74c3c";}
  document.getElementById("validate-btn").style.display="none";
  document.getElementById("next-btn").style.display="inline-block";
});
document.getElementById("next-btn").addEventListener("click",()=>{currentIndex++;if(currentIndex<totalQuestions)showQuestion();else showResult();});
document.getElementById("stop-btn").addEventListener("click",showResult);
function showResult(){
  document.getElementById("question-container").innerHTML="";
  document.getElementById("validate-btn").style.display="none";
  document.getElementById("next-btn").style.display="none";
  document.getElementById("stop-btn").style.display="none";
  document.getElementById("feedback").textContent="";
  const success=score>=minScore;
  const txt=`Score : ${score} / ${totalQuestions}<br>${success?"üéâ R√©ussi !":"‚ùå Non valid√©"}`;
  document.getElementById("result").innerHTML=txt;
  const newBtn=document.createElement("button");newBtn.textContent="üîÅ Nouveau quiz";newBtn.className="blue-btn";
  newBtn.onclick=()=>{document.getElementById("result").innerHTML="";loadQuestions(currentFile);};
  const homeBtn=document.createElement("button");homeBtn.textContent="üè† Accueil";homeBtn.id="home-btn";homeBtn.onclick=()=>location.reload();
  document.getElementById("result").appendChild(document.createElement("br"));
  document.getElementById("result").appendChild(newBtn);
  document.getElementById("result").appendChild(document.createTextNode(" "));
  document.getElementById("result").appendChild(homeBtn);
}
</script>
</body>
</html>
